# üöÄ B2B Bubble Tea E-shop Backend - Komplexn√≠ TODO

## üìä P≈ôehled projektu
- **Celkov√Ω odhad:** 6-8 t√Ωdn≈Ø (240-320 hodin)
- **Tech stack:** Node.js + Fastify + GraphQL (Apollo Server) + JWT + Redis + PostgreSQL (Prisma) + Comgate V2
- **C√≠l:** P≈ôipravit backend tak, aby frontend v√Ωvoj√°≈ô mƒõl minimum pr√°ce

---

## üóìÔ∏è F√°ze 1: Datab√°ze a z√°kladn√≠ infrastruktura (T√Ωden 1-2)

### ‚úÖ Hotovo
- [x] Z√°kladn√≠ package.json s dependencies
- [x] Z√°kladn√≠ Prisma schema
- [x] Dokumentace v Docusaurus

### üîÑ Week 1: Railway setup a datab√°zov√© modely

#### üöÄ Railway a CI/CD setup (10-12 hodin) - **PRIORITA #1**
- [ ] **Railway projekt setup**
  - [ ] Vytvo≈ôen√≠ Railway √∫ƒçtu a projektu
  - [ ] GitHub repository propojen√≠
  - [ ] PostgreSQL datab√°ze provision (production + test)
  - [ ] Redis addon p≈ôid√°n√≠
- [ ] **CI/CD pipeline s testy**
  - [ ] GitHub Actions workflow (.github/workflows/ci.yml)
  - [ ] Test datab√°ze setup v CI (PostgreSQL service)
  - [ ] Lint + Format + Test + Deploy pipeline
  - [ ] Deploy pouze pokud v≈°echny testy pro≈°ly
- [ ] **Environment konfigurace**
  - [ ] `.env.example` template
  - [ ] Railway environment variables (DATABASE_URL, REDIS_URL, JWT_SECRET)
  - [ ] Test environment variables (TEST_DATABASE_URL)
  - [ ] Environment validation (joi/zod)
- [ ] **Z√°kladn√≠ deployment test**
  - [ ] Minim√°ln√≠ Fastify server
  - [ ] Health check endpoint
  - [ ] Successful deployment verification

#### üß™ Testing infrastruktura (8-10 hodin) - **PRIORITA #2**
- [ ] **Testing setup**
  - [ ] Jest konfigurace (jest.config.js, jest.e2e.config.js)
  - [ ] Test datab√°ze setup a cleanup
  - [ ] Test utilities a helpers
  - [ ] Fake data generators (@faker-js/faker)
- [ ] **Code quality tools**
  - [ ] ESLint konfigurace (.eslintrc.js)
  - [ ] Prettier konfigurace (.prettierrc)
  - [ ] Husky pre-commit hooks
  - [ ] lint-staged konfigurace
- [ ] **Test struktura**
  - [ ] `tests/unit/` - unit testy
  - [ ] `tests/integration/` - integration testy
  - [ ] `tests/e2e/` - end-to-end testy
  - [ ] `tests/fixtures/` - test data
  - [ ] `tests/helpers/` - test utilities
- [ ] **Z√°kladn√≠ testy**
  - [ ] Health check endpoint test
  - [ ] Database connection test
  - [ ] Environment validation test

#### üìã Roz≈°√≠≈ôen√≠ Prisma Schema (8-12 hodin)
- [ ] **Kategorie produkt≈Ø** - model Category s hierarchi√≠
  - [ ] Enum pro typy: SIRUPY, TOPPINGS, PRASKY_SMESI, VYBAVENI, CAJE
  - [ ] Podpora pro subcategories (parent/children vztah)
- [ ] **Roz≈°√≠≈ôen√Ω Product model** 
  - [ ] Kategorie vztah (categoryId)
  - [ ] Jednotky (unit: KS/BAL, weightPerUnit, volumePerUnit)
  - [ ] Inventory (inStock boolean, stockQuantity)
  - [ ] SEO fields (slug, metaDescription)
- [ ] **B2B User model roz≈°√≠≈ôen√≠**
  - [ ] Role enum (CUSTOMER, ADMIN)
  - [ ] Firemn√≠ √∫daje (companyName, ico, dic, address)
  - [ ] Status (PENDING, APPROVED, BLOCKED)
- [ ] **Individu√°ln√≠ ceny - CustomerPrice model**
  - [ ] Vztah User <-> Product s custom cenou
  - [ ] Platnost ceny (validFrom, validTo)
- [ ] **Detailn√≠ Order system**
  - [ ] Status enum (PENDING, PAID, PROCESSING, SHIPPED, DELIVERED, CANCELLED)
  - [ ] Shipping info (address, method, cost)
  - [ ] Payment info (paymentId, paymentMethod, paidAt)
- [ ] **Email templates a logs**
  - [ ] EmailTemplate model (typ, subject, body)
  - [ ] EmailLog model (tracking odeslan√Ωch email≈Ø)

#### üóÑÔ∏è Database setup na Railway (4-6 hodin)
- [ ] **Prisma konfigurace**
  - [ ] Database URL z Railway
  - [ ] Prisma migrate na production datab√°zi
  - [ ] Seed data (kategorie, admin user, testovac√≠ produkty)
  - [ ] Prisma Studio p≈ô√≠stup k production DB

### üîÑ Week 2: Z√°kladn√≠ server infrastruktura

#### üöÄ Fastify + Apollo Server setup (12-16 hodin)
- [ ] **Z√°kladn√≠ server struktura**
  - [ ] `src/index.js` - entry point s Fastify
  - [ ] `src/config/` - konfigurace (database, redis, jwt)
  - [ ] `src/graphql/` - Apollo Server setup
  - [ ] `src/utils/` - helper funkce
- [ ] **Apollo Server integrace**
  - [ ] Apollo Server 4 setup s Fastify
  - [ ] GraphQL schema definice (typeDefs)
  - [ ] Context setup (user z JWT)
  - [ ] Apollo Studio v development
- [ ] **Middleware a pluginy**
  - [ ] JWT authentication middleware
  - [ ] CORS konfigurace
  - [ ] Rate limiting (pro GraphQL endpoint)
  - [ ] Request logging
  - [ ] Error handling
- [ ] **Redis integrace**
  - [ ] Redis client setup
  - [ ] Session storage
  - [ ] Cache helper funkce
- [ ] **Health check endpoints**
  - [ ] `/health` - z√°kladn√≠ health check
  - [ ] `/health/db` - database connectivity
  - [ ] `/health/redis` - redis connectivity

---

## üóìÔ∏è F√°ze 2: GraphQL API a autentizace (T√Ωden 3-4)

### üîÑ Week 3: GraphQL schema a z√°kladn√≠ resolvers

#### üìù GraphQL schema definice (16-20 hodin)
- [ ] **GraphQL typy podle dokumentace**
  - [ ] User, Customer, Admin typy
  - [ ] Product, Category, CustomerPrice typy
  - [ ] Order, OrderItem, OrderStatus typy
  - [ ] Input typy pro mutations
  - [ ] Enum typy (Role, OrderStatus, Category, Unit)
- [ ] **Query resolvers**
  - [ ] `products` - s filtry (kategorie, search, cena)
  - [ ] `product(id)` - detail produktu
  - [ ] `categories` - hierarchie kategori√≠
  - [ ] `me` - souƒçasn√Ω u≈æivatel
  - [ ] `orders` - objedn√°vky u≈æivatele
  - [ ] `order(id)` - detail objedn√°vky
- [ ] **Admin queries**
  - [ ] `allUsers` - spr√°va z√°kazn√≠k≈Ø
  - [ ] `allOrders` - v≈°echny objedn√°vky
  - [ ] `analytics` - z√°kladn√≠ statistiky
- [ ] **Apollo Server integrace**
  - [ ] Apollo Server setup s Fastify
  - [ ] GraphQL Playground/Apollo Studio setup
  - [ ] Schema definice a resolvers
  - [ ] Context setup (user authentication)

#### üîê Autentizace a autorizace (12-16 hodin)
- [ ] **JWT implementace**
  - [ ] Token generov√°n√≠ a validace
  - [ ] Refresh token mechanismus
  - [ ] Context injection (currentUser)
- [ ] **Auth mutations**
  - [ ] `register` - registrace B2B z√°kazn√≠ka
  - [ ] `login` - p≈ôihl√°≈°en√≠
  - [ ] `refreshToken` - obnoven√≠ tokenu
  - [ ] `requestPasswordReset` - reset hesla
  - [ ] `resetPassword` - potvrzen√≠ reset hesla
- [ ] **Authorization guards**
  - [ ] Role-based access control
  - [ ] Resource ownership validation
  - [ ] Admin-only operations

### üîÑ Week 4: Business logic a mutations

#### üõí E-commerce mutations (16-20 hodin)
- [ ] **Product management (Admin)**
  - [ ] `createProduct` - vytvo≈ôen√≠ produktu
  - [ ] `updateProduct` - √∫prava produktu
  - [ ] `deleteProduct` - smaz√°n√≠ produktu
  - [ ] `setCustomerPrice` - individu√°ln√≠ cena
- [ ] **Order management**
  - [ ] `createOrder` - vytvo≈ôen√≠ objedn√°vky
  - [ ] `updateOrderStatus` - zmƒõna stavu (Admin)
  - [ ] `cancelOrder` - zru≈°en√≠ objedn√°vky
  - [ ] `addOrderItem` - p≈ôid√°n√≠ polo≈æky
  - [ ] `removeOrderItem` - odebr√°n√≠ polo≈æky
- [ ] **User management**
  - [ ] `updateProfile` - √∫prava profilu
  - [ ] `approveCustomer` - schv√°len√≠ z√°kazn√≠ka (Admin)
  - [ ] `blockCustomer` - blokov√°n√≠ z√°kazn√≠ka (Admin)

#### üîç Advanced features (8-12 hodin)
- [ ] **Search a filtering**
  - [ ] Full-text search v produktech
  - [ ] Pokroƒçil√© filtry (cena, kategorie, dostupnost)
  - [ ] Sorting options
- [ ] **Caching strategie**
  - [ ] Redis cache pro produkty
  - [ ] Cache invalidation
  - [ ] Performance optimalizace

---

## üóìÔ∏è F√°ze 3: Platby a email syst√©m (T√Ωden 5)

### üí≥ Comgate V2 integrace (20-24 hodin)
- [ ] **Comgate API client**
  - [ ] REST API wrapper
  - [ ] Authentication (API key)
  - [ ] Error handling a retry logic
- [ ] **Payment flow**
  - [ ] `createPayment` - inicializace platby
  - [ ] Payment redirect URL generov√°n√≠
  - [ ] Webhook endpoint pro status updates
  - [ ] Payment verification
- [ ] **Order synchronizace**
  - [ ] Automatick√° zmƒõna stavu p≈ôi √∫spƒõ≈°n√© platbƒõ
  - [ ] Handling failed payments
  - [ ] Refund support (z√°kladn√≠)
- [ ] **Testing a validation**
  - [ ] Sandbox environment setup
  - [ ] Test payment scenarios
  - [ ] Webhook security validation

### üìß Email syst√©m (12-16 hodin)
- [ ] **Nodemailer setup**
  - [ ] SMTP konfigurace
  - [ ] Email templates engine (handlebars)
  - [ ] Attachment support
- [ ] **Email templates**
  - [ ] Registrace potvrzen√≠
  - [ ] Order confirmation
  - [ ] Payment confirmation
  - [ ] Shipping notification
  - [ ] Delivery confirmation
- [ ] **Email queue system**
  - [ ] Background job processing
  - [ ] Retry mechanism
  - [ ] Email delivery tracking

---

## üóìÔ∏è F√°ze 4: Testing a optimalizace (T√Ωden 6)

### üß™ Testing (16-20 hodin)
- [ ] **Unit tests**
  - [ ] Utility funkce testy
  - [ ] Database model testy
  - [ ] Business logic testy
- [ ] **Integration tests**
  - [ ] GraphQL resolver testy
  - [ ] Authentication flow testy
  - [ ] Payment integration testy
- [ ] **E2E tests**
  - [ ] Complete order flow
  - [ ] Admin operations
  - [ ] Error scenarios

### ‚ö° Performance a security (12-16 hodin)
- [ ] **Performance optimalizace**
  - [ ] Database indexy
  - [ ] N+1 query elimination
  - [ ] Response caching
  - [ ] Connection pooling
- [ ] **Security hardening**
  - [ ] Input validation (joi/zod)
  - [ ] SQL injection prevention
  - [ ] XSS protection
  - [ ] Rate limiting fine-tuning
- [ ] **Monitoring setup**
  - [ ] Logging strategy
  - [ ] Error tracking
  - [ ] Performance metrics

---

## üóìÔ∏è F√°ze 5: Deployment a dokumentace (T√Ωden 7-8)

### üöÄ Railway deployment (12-16 hodin)
- [ ] **Production setup**
  - [ ] Environment variables konfigurace
  - [ ] Database migration strategy
  - [ ] Redis setup na Railway
- [ ] **CI/CD pipeline**
  - [ ] GitHub Actions workflow
  - [ ] Automated testing
  - [ ] Deployment automation
- [ ] **Monitoring a health checks**
  - [ ] Application monitoring
  - [ ] Database monitoring
  - [ ] Alert setup

### üìö Fin√°ln√≠ dokumentace (8-12 hodin)
- [ ] **API dokumentace update**
  - [ ] GraphQL schema export
  - [ ] Mutation examples
  - [ ] Error codes dokumentace
- [ ] **Frontend integration guide**
  - [ ] Apollo Client setup
  - [ ] Authentication patterns
  - [ ] Common queries/mutations
- [ ] **Admin dokumentace**
  - [ ] Deployment guide
  - [ ] Maintenance procedures
  - [ ] Troubleshooting guide

---

## üéØ Prioritn√≠ √∫koly na tento t√Ωden

### üî• Vysok√° priorita (udƒõlej prvn√≠)
1. **Railway setup + CI/CD** - deploy first p≈ô√≠stup! üöÄ
2. **Testing infrastruktura** - kvalita k√≥du od zaƒç√°tku! üß™
3. **Roz≈°√≠≈ôen√≠ Prisma schema** - na production datab√°zi s testy
4. **Z√°kladn√≠ Fastify server** - s automatick√Ωm deploymentem a testy

### üìã St≈ôedn√≠ priorita (pak)
4. **GraphQL schema definice** - struktura API
5. **JWT autentizace** - security z√°klad

### üìå N√≠zk√° priorita (pozdƒõji)
6. **Admin funkce** - a≈æ bude z√°klad hotov√Ω
7. **Advanced features** - optimalizace na konec

---

## üí° Tipy pro efektivn√≠ pr√°ci

### üõ†Ô∏è Development workflow
- V≈ædy zaƒçni s datab√°zov√Ωmi modely
- Testuj ka≈ædou funkci postupnƒõ (Prisma Studio, GraphQL Playground)
- Pou≈æ√≠vej TypeScript pro lep≈°√≠ developer experience
- Commituj ƒçasto s popisn√Ωmi zpr√°vami

### üé® UI/UX tipy pro frontend kolegu
- P≈ôiprav mock data pro rychl√Ω frontend v√Ωvoj
- Dokumentuj v≈°echny GraphQL queries s p≈ô√≠klady
- Vytvo≈ô Postman collection pro API testov√°n√≠
- Navrhni konzistentn√≠ error handling

### üìà Performance tipy
- Implementuj pagination u v≈°ech list≈Ø
- Pou≈æ√≠vej DataLoader pattern pro N+1 queries
- Cache ƒçasto pou≈æ√≠van√© data (produkty, kategorie)
- Optimalizuj database queries s explain

---

## ‚è∞ ƒåasov√Ω pl√°n (40h/t√Ωden)

| T√Ωden | Fokus | Hodiny | Kl√≠ƒçov√© deliverables |
|-------|-------|--------|---------------------|
| 1 | Database + Environment | 40h | Prisma schema, z√°kladn√≠ server |
| 2 | Server infrastruktura | 40h | Fastify setup, middleware |
| 3 | GraphQL + Auth | 40h | Schema, resolvers, JWT |
| 4 | Business logic | 40h | Mutations, advanced features |
| 5 | Payments + Emails | 40h | Comgate, Nodemailer |
| 6 | Testing + Performance | 40h | Tests, optimalizace |
| 7-8 | Deployment + Docs | 80h | Railway, dokumentace |

**Celkem: 320 hodin (8 t√Ωdn≈Ø full-time)**

---

*Tento TODO je ≈æiv√Ω dokument - aktualizuj ho podle pokroku a nov√Ωch po≈æadavk≈Ø! üöÄ* 